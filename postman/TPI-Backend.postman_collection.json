{
	"info": {
		"_postman_id": "tpi-backend-collection",
		"name": "TPI Backend - Sistema de Transporte de Contenedores",
		"description": "Colección de endpoints para el sistema de gestión de transporte de contenedores.\n\nAutenticación: OAuth2 con Keycloak (Resource Owner Password Credentials)",
		"schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
	},
	"auth": {
		"type": "bearer",
		"bearer": [
			{
				"key": "token",
				"value": "{{access_token}}",
				"type": "string"
			}
		]
	},
	"item": [
		{
			"name": "Authentication",
			"item": [
				{
					"name": "Get Token (CLIENTE)",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"if (pm.response.code === 200) {",
									"    const jsonData = pm.response.json();",
									"    pm.environment.set(\"access_token\", jsonData.access_token);",
									"    pm.environment.set(\"refresh_token\", jsonData.refresh_token);",
									"    console.log(\"Token obtenido exitosamente\");",
									"}"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [],
						"body": {
							"mode": "urlencoded",
							"urlencoded": [
								{
									"key": "client_id",
									"value": "{{client_id}}",
									"type": "text"
								},
								{
									"key": "username",
									"value": "{{cliente_username}}",
									"type": "text"
								},
								{
									"key": "password",
									"value": "{{cliente_password}}",
									"type": "text"
								},
								{
									"key": "grant_type",
									"value": "password",
									"type": "text"
								}
							]
						},
						"url": {
							"raw": "{{keycloak_url}}/realms/{{realm}}/protocol/openid-connect/token",
							"host": [
								"{{keycloak_url}}"
							],
							"path": [
								"realms",
								"{{realm}}",
								"protocol",
								"openid-connect",
								"token"
							]
						},
						"description": "Obtiene un access token para el usuario CLIENTE usando Direct Access Grant (Password Grant Type)"
					},
					"response": []
				},
				{
					"name": "Get Token (ADMIN)",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"if (pm.response.code === 200) {",
									"    const jsonData = pm.response.json();",
									"    pm.environment.set(\"access_token\", jsonData.access_token);",
									"    pm.environment.set(\"refresh_token\", jsonData.refresh_token);",
									"    console.log(\"Token ADMIN obtenido exitosamente\");",
									"}"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [],
						"body": {
							"mode": "urlencoded",
							"urlencoded": [
								{
									"key": "client_id",
									"value": "{{client_id}}",
									"type": "text"
								},
								{
									"key": "username",
									"value": "{{admin_username}}",
									"type": "text"
								},
								{
									"key": "password",
									"value": "{{admin_password}}",
									"type": "text"
								},
								{
									"key": "grant_type",
									"value": "password",
									"type": "text"
								}
							]
						},
						"url": {
							"raw": "{{keycloak_url}}/realms/{{realm}}/protocol/openid-connect/token",
							"host": [
								"{{keycloak_url}}"
							],
							"path": [
								"realms",
								"{{realm}}",
								"protocol",
								"openid-connect",
								"token"
							]
						}
					},
					"response": []
				},
				{
					"name": "Get Token (TRANSPORTISTA)",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"if (pm.response.code === 200) {",
									"    const jsonData = pm.response.json();",
									"    pm.environment.set(\"access_token\", jsonData.access_token);",
									"    pm.environment.set(\"refresh_token\", jsonData.refresh_token);",
									"    console.log(\"Token TRANSPORTISTA obtenido exitosamente\");",
									"}"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [],
						"body": {
							"mode": "urlencoded",
							"urlencoded": [
								{
									"key": "client_id",
									"value": "{{client_id}}",
									"type": "text"
								},
								{
									"key": "username",
									"value": "{{transportista_username}}",
									"type": "text"
								},
								{
									"key": "password",
									"value": "{{transportista_password}}",
									"type": "text"
								},
								{
									"key": "grant_type",
									"value": "password",
									"type": "text"
								}
							]
						},
						"url": {
							"raw": "{{keycloak_url}}/realms/{{realm}}/protocol/openid-connect/token",
							"host": [
								"{{keycloak_url}}"
							],
							"path": [
								"realms",
								"{{realm}}",
								"protocol",
								"openid-connect",
								"token"
							]
						}
					},
					"response": []
				},
				{
					"name": "Refresh Token",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"if (pm.response.code === 200) {",
									"    const jsonData = pm.response.json();",
									"    pm.environment.set(\"access_token\", jsonData.access_token);",
									"    pm.environment.set(\"refresh_token\", jsonData.refresh_token);",
									"}"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [],
						"body": {
							"mode": "urlencoded",
							"urlencoded": [
								{
									"key": "client_id",
									"value": "{{client_id}}",
									"type": "text"
								},
								{
									"key": "refresh_token",
									"value": "{{refresh_token}}",
									"type": "text"
								},
								{
									"key": "grant_type",
									"value": "refresh_token",
									"type": "text"
								}
							]
						},
						"url": {
							"raw": "{{keycloak_url}}/realms/{{realm}}/protocol/openid-connect/token",
							"host": [
								"{{keycloak_url}}"
							],
							"path": [
								"realms",
								"{{realm}}",
								"protocol",
								"openid-connect",
								"token"
							]
						}
					},
					"response": []
				}
			]
		},
		{
			"name": "Solicitudes",
			"item": [
				{
					"name": "Crear Solicitud (CU-01)",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"if (pm.response.code === 201) {",
									"    const jsonData = pm.response.json();",
									"    pm.environment.set(\"solicitud_id\", jsonData.id);",
									"    console.log(\"Solicitud creada con ID: \" + jsonData.id);",
									"}"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"cliente\": {\n    \"nombre\": \"Juan Pérez\",\n    \"email\": \"cliente1@example.com\",\n    \"telefono\": \"+5491112345678\",\n    \"direccion\": \"Av. Corrientes 1234\"\n  },\n  \"contenedor\": {\n    \"numeroSerie\": \"CONT-001\",\n    \"tipo\": \"40HC\",\n    \"peso\": 1500.0,\n    \"volumen\": 67.5\n  },\n  \"origenDireccion\": \"Buenos Aires\",\n  \"origenLatitud\": -34.603722,\n  \"origenLongitud\": -58.381592,\n  \"destinoDireccion\": \"Rosario\",\n  \"destinoLatitud\": -32.944766,\n  \"destinoLongitud\": -60.650243\n}"
						},
						"url": {
							"raw": "{{gateway_url}}/solicitudes",
							"host": [
								"{{gateway_url}}"
							],
							"path": [
								"solicitudes"
							]
						},
						"description": "RF 1.1 y RF 1.2: Crea una solicitud con creación atómica de cliente y contenedor"
					},
					"response": []
				},
				{
					"name": "Obtener Solicitud por ID (CU-02)",
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{gateway_url}}/solicitudes/{{solicitud_id}}",
							"host": [
								"{{gateway_url}}"
							],
							"path": [
								"solicitudes",
								"{{solicitud_id}}"
							]
						},
						"description": "Consulta el estado de una solicitud de transporte"
					},
					"response": []
				},
				{
					"name": "Listar Todas las Solicitudes (ADMIN)",
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{gateway_url}}/solicitudes",
							"host": [
								"{{gateway_url}}"
							],
							"path": [
								"solicitudes"
							]
						},
						"description": "Solo accesible para ADMIN"
					},
					"response": []
				},
				{
					"name": "Solicitudes por Cliente",
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{gateway_url}}/solicitudes/cliente/{{cliente_id}}",
							"host": [
								"{{gateway_url}}"
							],
							"path": [
								"solicitudes",
								"cliente",
								"{{cliente_id}}"
							]
						}
					},
					"response": []
				},
				{
					"name": "Solicitudes Pendientes (CU-05)",
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{gateway_url}}/solicitudes/pendientes",
							"host": [
								"{{gateway_url}}"
							],
							"path": [
								"solicitudes",
								"pendientes"
							]
						},
						"description": "Obtiene todas las solicitudes que no están entregadas"
					},
					"response": []
				},
				{
					"name": "Solicitudes por Estado",
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{gateway_url}}/solicitudes/por-estado?estado=BORRADOR",
							"host": [
								"{{gateway_url}}"
							],
							"path": [
								"solicitudes",
								"por-estado"
							],
							"query": [
								{
									"key": "estado",
									"value": "BORRADOR",
									"description": "BORRADOR, EN_PROCESO, ENTREGADA"
								}
							]
						}
					},
					"response": []
				},
				{
					"name": "Asignar Ruta a Solicitud (CU-04)",
					"request": {
						"method": "PUT",
						"header": [],
						"url": {
							"raw": "{{gateway_url}}/solicitudes/{{solicitud_id}}/ruta/{{ruta_id}}",
							"host": [
								"{{gateway_url}}"
							],
							"path": [
								"solicitudes",
								"{{solicitud_id}}",
								"ruta",
								"{{ruta_id}}"
							]
						}
					},
					"response": []
				},
				{
					"name": "Actualizar Estado Solicitud",
					"request": {
						"method": "PUT",
						"header": [],
						"url": {
							"raw": "{{gateway_url}}/solicitudes/{{solicitud_id}}/estado?nuevoEstado=EN_PROCESO",
							"host": [
								"{{gateway_url}}"
							],
							"path": [
								"solicitudes",
								"{{solicitud_id}}",
								"estado"
							],
							"query": [
								{
									"key": "nuevoEstado",
									"value": "EN_PROCESO"
								}
							]
						}
					},
					"response": []
				},
				{
					"name": "Actualizar Estimaciones",
					"request": {
						"method": "PUT",
						"header": [],
						"url": {
							"raw": "{{gateway_url}}/solicitudes/{{solicitud_id}}/estimaciones?costoEstimado=25000&tiempoEstimadoHoras=48",
							"host": [
								"{{gateway_url}}"
							],
							"path": [
								"solicitudes",
								"{{solicitud_id}}",
								"estimaciones"
							],
							"query": [
								{
									"key": "costoEstimado",
									"value": "25000"
								},
								{
									"key": "tiempoEstimadoHoras",
									"value": "48"
								}
							]
						}
					},
					"response": []
				}
			]
		},
		{
			"name": "Tramos",
			"item": [
				{
					"name": "Registrar Inicio de Tramo (CU-07)",
					"request": {
						"method": "POST",
						"header": [],
						"url": {
							"raw": "{{gateway_url}}/solicitudes/tramos/{{tramo_id}}/inicio",
							"host": [
								"{{gateway_url}}"
							],
							"path": [
								"solicitudes",
								"tramos",
								"{{tramo_id}}",
								"inicio"
							]
						},
						"description": "TRANSPORTISTA registra el inicio de un tramo"
					},
					"response": []
				},
				{
					"name": "Registrar Fin de Tramo (CU-08)",
					"request": {
						"method": "POST",
						"header": [],
						"url": {
							"raw": "{{gateway_url}}/solicitudes/tramos/{{tramo_id}}/fin",
							"host": [
								"{{gateway_url}}"
							],
							"path": [
								"solicitudes",
								"tramos",
								"{{tramo_id}}",
								"fin"
							]
						},
						"description": "TRANSPORTISTA registra el fin de un tramo"
					},
					"response": []
				}
			]
		},
		{
			"name": "Clientes",
			"item": [
				{
					"name": "Crear Cliente",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"if (pm.response.code === 201) {",
									"    const jsonData = pm.response.json();",
									"    pm.environment.set(\"cliente_id\", jsonData.id);",
									"}"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"nombre\": \"María González\",\n  \"email\": \"maria.gonzalez@example.com\",\n  \"telefono\": \"+5491123456789\",\n  \"direccion\": \"Av. Santa Fe 2500\"\n}"
						},
						"url": {
							"raw": "{{gateway_url}}/clientes",
							"host": [
								"{{gateway_url}}"
							],
							"path": [
								"clientes"
							]
						}
					},
					"response": []
				},
				{
					"name": "Obtener Cliente por ID",
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{gateway_url}}/clientes/{{cliente_id}}",
							"host": [
								"{{gateway_url}}"
							],
							"path": [
								"clientes",
								"{{cliente_id}}"
							]
						}
					},
					"response": []
				},
				{
					"name": "Listar Todos los Clientes",
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{gateway_url}}/clientes",
							"host": [
								"{{gateway_url}}"
							],
							"path": [
								"clientes"
							]
						}
					},
					"response": []
				},
				{
					"name": "Buscar Cliente por Email",
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{gateway_url}}/clientes/email/cliente1@example.com",
							"host": [
								"{{gateway_url}}"
							],
							"path": [
								"clientes",
								"email",
								"cliente1@example.com"
							]
						}
					},
					"response": []
				}
			]
		},
		{
			"name": "Contenedores",
			"item": [
				{
					"name": "Crear Contenedor",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"if (pm.response.code === 201) {",
									"    const jsonData = pm.response.json();",
									"    pm.environment.set(\"contenedor_id\", jsonData.id);",
									"}"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"numeroSerie\": \"CONT-002\",\n  \"tipo\": \"20DV\",\n  \"peso\": 800.0,\n  \"volumen\": 33.2,\n  \"clienteId\": {{cliente_id}}\n}"
						},
						"url": {
							"raw": "{{gateway_url}}/contenedores",
							"host": [
								"{{gateway_url}}"
							],
							"path": [
								"contenedores"
							]
						}
					},
					"response": []
				},
				{
					"name": "Obtener Contenedor por ID",
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{gateway_url}}/contenedores/{{contenedor_id}}",
							"host": [
								"{{gateway_url}}"
							],
							"path": [
								"contenedores",
								"{{contenedor_id}}"
							]
						}
					},
					"response": []
				},
				{
					"name": "Buscar Contenedor por Número de Serie",
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{gateway_url}}/contenedores/serie/CONT-001",
							"host": [
								"{{gateway_url}}"
							],
							"path": [
								"contenedores",
								"serie",
								"CONT-001"
							]
						}
					},
					"response": []
				},
				{
					"name": "Contenedores por Cliente",
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{gateway_url}}/contenedores/cliente/{{cliente_id}}",
							"host": [
								"{{gateway_url}}"
							],
							"path": [
								"contenedores",
								"cliente",
								"{{cliente_id}}"
							]
						}
					},
					"response": []
				},
				{
					"name": "Contenedores por Estado",
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{gateway_url}}/contenedores/estado?estado=REGISTRADO",
							"host": [
								"{{gateway_url}}"
							],
							"path": [
								"contenedores",
								"estado"
							],
							"query": [
								{
									"key": "estado",
									"value": "REGISTRADO",
									"description": "REGISTRADO, LISTO_PARA_RETIRO, EN_TRASLADO, EN_DEPOSITO, ENTREGADO"
								}
							]
						}
					},
					"response": []
				}
			]
		},
		{
			"name": "Flota",
			"item": [
				{
					"name": "Listar Camiones",
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{gateway_url}}/flota/camiones",
							"host": [
								"{{gateway_url}}"
							],
							"path": [
								"flota",
								"camiones"
							]
						},
						"description": "Accesible por ADMIN y TRANSPORTISTA"
					},
					"response": []
				},
				{
					"name": "Obtener Camión por ID",
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{gateway_url}}/flota/camiones/{{camion_id}}",
							"host": [
								"{{gateway_url}}"
							],
							"path": [
								"flota",
								"camiones",
								"{{camion_id}}"
							]
						}
					},
					"response": []
				},
				{
					"name": "Listar Depósitos",
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{gateway_url}}/flota/depositos",
							"host": [
								"{{gateway_url}}"
							],
							"path": [
								"flota",
								"depositos"
							]
						}
					},
					"response": []
				},
				{
					"name": "Obtener Depósito por ID",
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{gateway_url}}/flota/depositos/{{deposito_id}}",
							"host": [
								"{{gateway_url}}"
							],
							"path": [
								"flota",
								"depositos",
								"{{deposito_id}}"
							]
						}
					},
					"response": []
				}
			]
		},
		{
			"name": "Costos",
			"item": [
				{
					"name": "Listar Tarifas",
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{gateway_url}}/costos/tarifas",
							"host": [
								"{{gateway_url}}"
							],
							"path": [
								"costos",
								"tarifas"
							]
						},
						"description": "Accesible por ADMIN y CLIENTE"
					},
					"response": []
				},
				{
					"name": "Obtener Tarifa por ID",
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{gateway_url}}/costos/tarifas/{{tarifa_id}}",
							"host": [
								"{{gateway_url}}"
							],
							"path": [
								"costos",
								"tarifas",
								"{{tarifa_id}}"
							]
						}
					},
					"response": []
				}
			]
		},
		{
			"name": "Health & Actuator",
			"item": [
				{
					"name": "Health Check",
					"request": {
						"auth": {
							"type": "noauth"
						},
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{gateway_url}}/actuator/health",
							"host": [
								"{{gateway_url}}"
							],
							"path": [
								"actuator",
								"health"
							]
						},
						"description": "Endpoint público para verificar el estado del sistema"
					},
					"response": []
				},
				{
					"name": "Info",
					"request": {
						"auth": {
							"type": "noauth"
						},
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{gateway_url}}/actuator/info",
							"host": [
								"{{gateway_url}}"
							],
							"path": [
								"actuator",
								"info"
							]
						}
					},
					"response": []
				}
			]
		}
	]
}
